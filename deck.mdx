import {Image} from 'mdx-deck';
import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import { github, nightOwl } from "@code-surfer/themes";
import {themes} from 'mdx-deck';
export const theme = themes.yellow;

# Fun with Generator Functions

by [Jason Wohlgemuth](https://landr.me/jason) using [Code Surfer](https://codesurfer.pomb.us)

---

<CodeSurfer theme={nightOwl}>

```js title="This is a generator function"
function* iter(value) {
    // code code code
}
```

```js 1:7
function* iter(value) {
    yield 'one';
    yield 'two';
    yield value;
    yield* ['one', 'two', 'three'];
    return 'a value';
}
```

```js 1 subtitle="* not a footnote"
function* iter(value) {
    yield 'one';
    yield 'two';
    yield value;
    yield* ['one', 'two', 'three'];
    return 'a value';
}
```

```diff 2:3 subtitle="yield values one at a time"
```

```diff 1,4 subtitle="yield a passed parameter"
```

```diff 5 subtitle="yield an iterable"
```

```diff 6 subtitle="return (yield) a value"
```

```js
//TODO use generator functions
```

</CodeSurfer>

___

<CodeSurferColumns themes={[nightOwl, github]}>

<Step>

```js
function* iter(value) {
    yield 'one';
    yield 'two';
    yield value;
    yield ['a', 'b', 'c'];
    yield* ['a', 'b', 'c'];
}

```

```js 1

const foo = iter('three');
foo.next();
foo.next();
foo.next();
foo.next();
foo.next();
foo.next();
foo.next();
foo.next();
```

</Step>

<Step>

```diff 1
```

```diff 2 subtitle="Generator {  }"
```

</Step>

<Step>

```diff 2
```

```diff 3 subtitle="{value: 'one', done: false}"
```

</Step>

<Step>


```diff 3
```

```diff 4 subtitle="{value: 'two', done: false}"
```

</Step>

<Step>


```diff 1[16:20],4
```

```diff 2[18:24],5 subtitle="{value: 'three', done: false}"
```

</Step>

<Step>


```diff 5
```

```diff 6 subtitle="{value: ['a', 'b', 'c'], done: false}"
```

</Step>

<Step>


```diff 6[5:10,13:15]
```

```diff 7 subtitle="{value: 'a', done: false}"
```

</Step>

<Step>


```diff 6[5:10,17:20]
```

```diff 8 subtitle="{value: 'b', done: false}"
```

</Step>

<Step>


```diff 6[5:10,23:26]
```

```diff 9 subtitle="{value: 'c', done: true}"
```

</Step>

<Step>


```diff 9
```

```diff 10 subtitle="{value: undefined, done: true}"
```

</Step>

</CodeSurferColumns>

---

<CodeSurfer>

```js
//TODO use generator functions
```

```js
//TODO use generator functions
//TODO use generator functions with return
```

</CodeSurfer>

---

<CodeSurferColumns themes={[nightOwl, github]}>

<Step>

```js
function* iter() {
    yield 'What?!?';
    return 'OK!!!'; 
    yield 'Huh?';
}

```

```js 1

const john = iterWithReturn();
john.next();
john.next();
john.next();
```

</Step>

<Step>

```diff 1
```

```diff 2
```

</Step>

<Step>

```diff 2
```

```diff 3 subtitle="{value: 'What?!?', done: false}"
```

</Step>

<Step>

```diff 3
```

```diff 4 subtitle="{value: 'OK!!!', done: true}"
```

</Step>

<Step>

```diff 6
```

```diff 5 subtitle="{value: undefined, done: true}"
```

</Step>


</CodeSurferColumns>

---

<CodeSurfer>

```js
//TODO use generator functions
//TODO use generator functions with return
```

```js
//TODO use generator functions
//TODO use generator functions with return
//TODO use generator functions with parameters
```

</CodeSurfer>

---

<CodeSurferColumns themes={[nightOwl, github]}>

<Step>

```js
function* iter() {
    // first next stops here
    console.log(yield);
    console.log(yield);
    return yield;
}
```

```js 1

const foo = iter();
foo.next(0);
foo.next(1);
foo.next(2);
foo.next(3);
```

</Step>

<Step>

```diff 1
```

```diff 2
```

</Step>

<Step>

```diff 2
```

```diff 3 subtitle="{value: undefined, done: false}"
```

</Step>

<Step>

```diff 3
```

```diff 4 subtitle="{value: undefined, done: false}"
```

</Step>

<Step>

```diff 4
```

```diff 5 subtitle="{value: undefined, done: false}"
```

</Step>

<Step>

```diff 5
```

```diff 6 subtitle="{value: 3, done: true}"
```

</Step>

</CodeSurferColumns>

---

<CodeSurferColumns themes={[nightOwl, github]}>

<Step>

```js
function* iter() {
    // first next stops here
    const sum = yield + yield;
    return sum;
}
```

```js 1

const calc = add();
calc.next();
calc.next(40);
calc.next(2);
```

</Step>

<Step>

```diff 3 subtitle="FAIL"
```

```diff 1
```

</Step>

<Step>

```js
function* iter() {
    // first next stops here
    const sum = (yield) + (yield);
    return sum;
}
```

```diff 1
```

</Step>

<Step>

```js 1
function* iter() {
    // first next stops here
    const sum = (yield) + (yield);
    return sum;
}
```

```diff 2 subtitle="Generator {  }"
```

</Step>

<Step>

```diff 2
```

```diff 3 title="start" subtitle="{value: undefined, done: false}"
```

</Step>

<Step>

```diff 3[17:23]
```

```diff 4 title="add 40" subtitle="{value: undefined, done: false}"
```

</Step>

<Step>

```diff 3[26:33],4
```

```diff 5 title="add 2, return result" subtitle="{value: 42, done: true}"
```

</Step>

</CodeSurferColumns>

---

<CodeSurfer>

```js
//TODO use generator functions
//TODO use generator functions with return
//TODO use generator functions with parameters
```

```js
//TODO use generator functions
//TODO use generator functions with return
//TODO use generator functions with parameters
//TODO use generator functions as object property
```

</CodeSurfer>

---

<CodeSurfer theme={nightOwl}>

```js title="This is a function as an object property"
const foo = {
    iter() {
        // code code code
    }
};
```

```js 1:5 title="This is a generator function as an object property"
const foo = {
    *iter() {
        // code code code
    }
};
```

</CodeSurfer>

---

<CodeSurfer>

```js
//TODO use generator functions
//TODO use generator functions with return
//TODO use generator functions with parameters
//TODO use generator functions as object property
```

```js
//TODO use generator functions
//TODO use generator functions with return
//TODO use generator functions with parameters
//TODO use generator functions as object property
//TODO use generator functions as computed property
```

</CodeSurfer>

---

<CodeSurfer theme={nightOwl}>

```js
const iter = {
    *[Symbol.iterator]() {
        yield 1;
        yield 2;
        yield 3;
    }
};
```

```diff 2 title="implement the @@iterator method"
```

```js subtitle="[1, 2, 3]"
const iter = {
    *[Symbol.iterator]() {
        yield 1;
        yield 2;
        yield 3;
    }
};

const easy = [...iter];
console.log(easy);
```

</CodeSurfer>

---

<CodeSurfer>

```js
//TODO use generator functions
//TODO use generator functions with return
//TODO use generator functions with parameters
//TODO use generator functions as object property
//TODO use generator functions as computed property
```

```js
//TODO use generator functions
//TODO use generator functions with return
//TODO use generator functions with parameters
//TODO use generator functions as object property
//TODO use generator functions as computed property
//TODO use generator functions in real life
```

</CodeSurfer>

---

<CodeSurfer theme={nightOwl}>

```js title="Real world example"
function* seq(start, stop) {
    let index = start;
    while (index <= stop) {
        yield index++;
    }
}
```

```js 1:7 title="Real world example"
function* seq(...args) {
    const [start, stop] = args;
    let index = stop ? start : 0;
    while (index <= (stop || start)) {
        yield index++;
    }
}
```

```diff 1
```

```diff 2
```

```diff 3
```

```diff 4
```

```js subtitle="[3, 4, 5, 6, 7]"
function* seq(...args) {
    const [start, stop] = args;
    let index = stop ? start : 0;
    while (index <= (stop || start)) {
        yield index++;
    }
}

const numbers = [...seq(3, 7)];
console.log(numbers);
```

```js subtitle="{value: undefined, done: true}"
function* seq(...args) {
    const [start, stop] = args;
    let index = stop ? start : 0;
    while (index <= (stop || start)) {
        yield index++;
    }
}

const range = seq(5);
const numbers = [...range];
console.log(range.next());
```

```js subtitle="[0, 1, 2, 3, 4, 5]"
function* seq(...args) {
    const [start, stop] = args;
    let index = stop ? start : 0;
    while (index <= (stop || start)) {
        yield index++;
    }
}

const range = seq(5);
const numbers = [...range];
console.log(range.next());
console.log(numbers);
```

</CodeSurfer>

---

<CodeSurfer theme={nightOwl}>

```js title="Another real world example"
const toArray = val => [...val[Symbol.iterator]()];
```

```diff 1[31:47] subtitle="ordinary function, or generator function???"
```

```js title="turns strings into arrays" subtitle="['a', 'b', 'c']"
const toArray = val => [...val[Symbol.iterator]()];

toArray('abc');
```

```js title="...and acts like identity for arrays!" subtitle="['a', 'b', 'c']"
const toArray = val => [...val[Symbol.iterator]()];

toArray('abc');

toArray(['a', 'b', 'c']);
```

</CodeSurfer>

---

## References
- [ECMAScript Language Specification](http://www.ecma-international.org/ecma-262/6.0/#sec-generator-function-definitions)
- [MDN Docs for function*](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*)
- [Breaking Chains with Pipelines in JavaScript](https://www.wix.engineering/post/breaking-chains-with-pipelines-in-modern-javascript)
- [JavaScript Iterators and Generators: Synchronous Generators](https://dev.to/jfet97/javascript-iterators-and-generators-synchronous-generators-3ai4)
